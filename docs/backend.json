{
  "entities": {
    "Patient": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Patient",
      "type": "object",
      "description": "Represents a patient in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Patient entity."
        },
        "firstName": {
          "type": "string",
          "description": "Patient's first name."
        },
        "lastName": {
          "type": "string",
          "description": "Patient's last name."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "Patient's date of birth.",
          "format": "date-time"
        },
        "gender": {
          "type": "string",
          "description": "Patient's gender."
        },
        "contactNumber": {
          "type": "string",
          "description": "Patient's contact phone number."
        },
        "email": {
          "type": "string",
          "description": "Patient's email address.",
          "format": "email"
        },
        "address": {
          "type": "string",
          "description": "Patient's address."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "dateOfBirth",
        "gender",
        "contactNumber",
        "email",
        "address"
      ]
    },
    "Doctor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Doctor",
      "type": "object",
      "description": "Represents a doctor in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Doctor entity."
        },
        "firstName": {
          "type": "string",
          "description": "Doctor's first name."
        },
        "lastName": {
          "type": "string",
          "description": "Doctor's last name."
        },
        "specialization": {
          "type": "string",
          "description": "Doctor's specialization."
        },
        "contactNumber": {
          "type": "string",
          "description": "Doctor's contact phone number."
        },
        "email": {
          "type": "string",
          "description": "Doctor's email address.",
          "format": "email"
        },
        "hospitalId": {
          "type": "string",
          "description": "Reference to Hospital. (Relationship: Hospital 1:N Doctor)"
        },
        "role": {
          "type": "string",
          "description": "The role of the doctor within the hospital.",
          "enum": ["doctor", "head_doctor"]
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "specialization",
        "contactNumber",
        "email",
        "hospitalId",
        "role"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an admin user in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Admin entity (matches user UID)."
        },
        "email": {
          "type": "string",
          "description": "Admin's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user.",
          "enum": ["admin"]
        }
      },
      "required": ["id", "email", "role"]
    },
    "Hospital": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hospital",
      "type": "object",
      "description": "Represents a hospital in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Hospital entity."
        },
        "name": {
          "type": "string",
          "description": "Hospital's name."
        },
        "address": {
          "type": "string",
          "description": "Hospital's address."
        },
        "contactNumber": {
          "type": "string",
          "description": "Hospital's contact phone number."
        },
        "email": {
          "type": "string",
          "description": "Hospital's email address.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name",
        "address",
        "contactNumber",
        "email"
      ]
    },
    "Pharmacy": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Pharmacy",
      "type": "object",
      "description": "Represents a pharmacy in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Pharmacy entity."
        },
        "name": {
          "type": "string",
          "description": "Pharmacy's name."
        },
        "address": {
          "type": "string",
          "description": "Pharmacy's address."
        },
        "contactNumber": {
          "type": "string",
          "description": "Pharmacy's contact phone number."
        },
        "email": {
          "type": "string",
          "description": "Pharmacy's email address.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name",
        "address",
        "contactNumber",
        "email"
      ]
    },
    "Medication": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Medication",
      "type": "object",
      "description": "Represents a medication in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Medication entity."
        },
        "name": {
          "type": "string",
          "description": "Medication's name."
        },
        "dosage": {
          "type": "string",
          "description": "Medication's dosage."
        },
        "unit": {
          "type": "string",
          "description": "Unit of measurement for the medication (e.g., mg, ml)."
        },
        "form": {
          "type": "string",
          "description": "Medication's form (e.g., tablet, capsule, liquid)."
        }
      },
      "required": [
        "id",
        "name",
        "dosage",
        "unit",
        "form"
      ]
    },
    "Prescription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Prescription",
      "type": "object",
      "description": "Represents a prescription in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Prescription entity."
        },
        "patientId": {
          "type": "string",
          "description": "Reference to Patient. (Relationship: Patient 1:N Prescription)"
        },
        "doctorId": {
          "type": "string",
          "description": "Reference to Doctor. (Relationship: Doctor 1:N Prescription)"
        },
        "pharmacyId": {
          "type": "string",
          "description": "Reference to Pharmacy. (Relationship: Pharmacy 1:N Prescription)"
        },
        "medicationId": {
          "type": "string",
          "description": "Reference to Medication. (Relationship: Medication 1:N Prescription)"
        },
        "datePrescribed": {
          "type": "string",
          "description": "Date the prescription was prescribed.",
          "format": "date-time"
        },
        "dosage": {
          "type": "string",
          "description": "Dosage of the medication prescribed."
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the medication prescribed."
        },
        "refills": {
          "type": "number",
          "description": "Number of refills allowed for the prescription."
        },
        "instructions": {
          "type": "string",
          "description": "Additional instructions for the patient."
        },
        "verificationCode": {
          "type": "string",
          "description": "Verification code of the prescription. Used to verify the OTP."
        }
      },
      "required": [
        "id",
        "patientId",
        "doctorId",
        "pharmacyId",
        "medicationId",
        "datePrescribed",
        "dosage",
        "quantity",
        "refills",
        "instructions",
        "verificationCode"
      ]
    },
    "Inventory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Inventory",
      "type": "object",
      "description": "Represents the inventory of a pharmacy.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Inventory entity."
        },
        "pharmacyId": {
          "type": "string",
          "description": "Reference to Pharmacy. (Relationship: Pharmacy 1:N Inventory)"
        },
        "medicationId": {
          "type": "string",
          "description": "Reference to Medication. (Relationship: Medication 1:N Inventory)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the medication in stock."
        },
        "expirationDate": {
          "type": "string",
          "description": "Expiration date of the medication.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "pharmacyId",
        "medicationId",
        "quantity",
        "expirationDate"
      ]
    },
    "SupportingOrganization": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SupportingOrganization",
      "type": "object",
      "description": "Represents an organization that supports the ReseptPlus project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Supporting Organization entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the supporting organization."
        },
        "description": {
          "type": "string",
          "description": "A short description of the organization's support."
        },
        "logoUrl": {
          "type": "string",
          "description": "URL of the organization's logo."
        }
      },
      "required": ["id", "name", "description", "logoUrl"]
    },
    "ClientCompany": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ClientCompany",
      "type": "object",
      "description": "Represents a client company using the ReseptPlus platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Client Company entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the client company."
        },
        "description": {
          "type": "string",
          "description": "A short description of the company."
        },
        "logoUrl": {
          "type": "string",
          "description": "URL of the company's logo."
        }
      },
      "required": ["id", "name", "description", "logoUrl"]
    },
    "BlogPost": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BlogPost",
      "type": "object",
      "description": "Represents a blog post on the marketing site.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Blog Post entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the blog post."
        },
        "description": {
          "type": "string",
          "description": "A short summary or description of the blog post."
        },
        "content": {
          "type": "string",
          "description": "The full content of the blog post, likely in Markdown format."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL for the main image of the blog post."
        },
        "imageHint": {
          "type": "string",
          "description": "A hint for AI to find a relevant image."
        },
        "author": {
          "type": "string",
          "description": "The name of the post's author."
        },
        "datePublished": {
          "type": "string",
          "format": "date-time",
          "description": "The date the blog post was published."
        }
      },
      "required": ["id", "title", "description", "content", "author", "datePublished", "imageUrl"]
    },
     "PricingPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PricingPlan",
      "type": "object",
      "description": "Represents a pricing plan for the ReseptPlus service.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Pricing Plan entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the pricing plan."
        },
        "description": {
          "type": "string",
          "description": "A short description of the plan."
        },
        "price": {
          "type": "string",
          "description": "The price of the plan, can be a number or 'Custom'."
        },
        "period": {
          "type": "string",
          "description": "The billing period, e.g., '/ay'."
        },
        "features": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "A list of features included in the plan."
        },
        "isPopular": {
          "type": "boolean",
          "description": "Whether the plan is marked as popular."
        }
      },
      "required": ["id", "title", "description", "price", "features", "isPopular"]
    },
    "ProductFeature": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ProductFeature",
      "type": "object",
      "description": "Represents a feature of the product, displayed on the marketing site.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product Feature entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the feature."
        },
        "description": {
          "type": "string",
          "description": "A short description of the feature."
        },
        "icon": {
          "type": "string",
          "description": "The name of the lucide-react icon to display for the feature."
        }
      },
      "required": ["id", "title", "description", "icon"]
    },
    "TeamMember": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TeamMember",
      "type": "object",
      "description": "Represents a team member of the ReseptPlus project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Team Member entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the team member."
        },
        "role": {
          "type": "string",
          "description": "The role or title of the team member."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the team member's avatar/photo."
        },
        "imageHint": {
          "type": "string",
          "description": "A hint for AI to find a relevant image for the team member."
        }
      },
      "required": ["id", "name", "role", "imageUrl"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/patients/{patientId}",
        "definition": {
          "entityName": "Patient",
          "schema": {
            "$ref": "#/backend/entities/Patient"
          },
          "description": "Stores patient profiles. Path-based ownership ensures only the authenticated user (or authorized personnel) can access their profile data.",
          "params": [
            {
              "name": "patientId",
              "description": "The unique identifier for the patient."
            }
          ]
        }
      },
      {
        "path": "/doctors/{doctorId}",
        "definition": {
          "entityName": "Doctor",
          "schema": {
            "$ref": "#/backend/entities/Doctor"
          },
          "description": "Stores doctor profiles. Accessible to authorized personnel.",
          "params": [
            {
              "name": "doctorId",
              "description": "The unique identifier for the doctor."
            }
          ]
        }
      },
      {
        "path": "/admins/{adminId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Stores admin user profiles. Only accessible by other admins.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier for the admin user."
            }
          ]
        }
      },
      {
        "path": "/hospitals/{hospitalId}",
        "definition": {
          "entityName": "Hospital",
          "schema": {
            "$ref": "#/backend/entities/Hospital"
          },
          "description": "Stores hospital information. Accessible to authorized personnel.",
          "params": [
            {
              "name": "hospitalId",
              "description": "The unique identifier for the hospital."
            }
          ]
        }
      },
      {
        "path": "/pharmacies/{pharmacyId}",
        "definition": {
          "entityName": "Pharmacy",
          "schema": {
            "$ref": "#/backend/entities/Pharmacy"
          },
          "description": "Stores pharmacy information. Accessible to authorized personnel.",
          "params": [
            {
              "name": "pharmacyId",
              "description": "The unique identifier for the pharmacy."
            }
          ]
        }
      },
      {
        "path": "/medications/{medicationId}",
        "definition": {
          "entityName": "Medication",
          "schema": {
            "$ref": "#/backend/entities/Medication"
          },
          "description": "Stores medication details. Publicly accessible or restricted to authorized personnel.",
          "params": [
            {
              "name": "medicationId",
              "description": "The unique identifier for the medication."
            }
          ]
        }
      },
      {
        "path": "/prescriptions/{prescriptionId}",
        "definition": {
          "entityName": "Prescription",
          "schema": {
            "$ref": "#/backend/entities/Prescription"
          },
          "description": "Stores prescription data. Includes denormalized `patientId`, `doctorId`, and `pharmacyId` to enable authorization independence. Accessible to the patient, doctor, and pharmacy involved in the prescription.",
          "params": [
            {
              "name": "prescriptionId",
              "description": "The unique identifier for the prescription."
            }
          ]
        }
      },
      {
        "path": "/pharmacies/{pharmacyId}/inventory/{inventoryId}",
        "definition": {
          "entityName": "Inventory",
          "schema": {
            "$ref": "#/backend/entities/Inventory"
          },
          "description": "Stores inventory information for each pharmacy. The `pharmacyId` parameter in the path ensures only the pharmacy can access this data.",
          "params": [
            {
              "name": "pharmacyId",
              "description": "The unique identifier for the pharmacy."
            },
            {
              "name": "inventoryId",
              "description": "The unique identifier for the inventory item."
            }
          ]
        }
      },
      {
        "path": "/supportingOrganizations/{orgId}",
        "definition": {
          "entityName": "SupportingOrganization",
          "schema": {
            "$ref": "#/backend/entities/SupportingOrganization"
          },
          "description": "Stores information about organizations that support ReseptPlus. Publicly readable, admin writable.",
          "params": [
            {
              "name": "orgId",
              "description": "The unique identifier for the supporting organization."
            }
          ]
        }
      },
      {
        "path": "/clientCompanies/{companyId}",
        "definition": {
          "entityName": "ClientCompany",
          "schema": {
            "$ref": "#/backend/entities/ClientCompany"
          },
          "description": "Stores information about companies that are clients of ReseptPlus. Publicly readable, admin writable.",
          "params": [
            {
              "name": "companyId",
              "description": "The unique identifier for the client company."
            }
          ]
        }
      },
      {
        "path": "/blogPosts/{postId}",
        "definition": {
          "entityName": "BlogPost",
          "schema": {
            "$ref": "#/backend/entities/BlogPost"
          },
          "description": "Stores blog posts for the marketing website. Publicly readable, admin writable.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier for the blog post."
            }
          ]
        }
      },
      {
        "path": "/pricingPlans/{planId}",
        "definition": {
          "entityName": "PricingPlan",
          "schema": {
            "$ref": "#/backend/entities/PricingPlan"
          },
          "description": "Stores the pricing plans for the service. Publicly readable, admin writable.",
          "params": [
            {
              "name": "planId",
              "description": "The unique identifier for the pricing plan."
            }
          ]
        }
      },
      {
        "path": "/productFeatures/{featureId}",
        "definition": {
          "entityName": "ProductFeature",
          "schema": {
            "$ref": "#/backend/entities/ProductFeature"
          },
          "description": "Stores the product features for the marketing site. Publicly readable, admin writable.",
          "params": [
            {
              "name": "featureId",
              "description": "The unique identifier for the product feature."
            }
          ]
        }
      },
       {
        "path": "/teamMembers/{memberId}",
        "definition": {
          "entityName": "TeamMember",
          "schema": {
            "$ref": "#/backend/entities/TeamMember"
          },
          "description": "Stores information about team members. Publicly readable, admin writable.",
          "params": [
            {
              "name": "memberId",
              "description": "The unique identifier for the team member."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support a secure and scalable e-prescription system (ReseptPlus) connecting patients, doctors, hospitals, and pharmacies. Key considerations include authorization independence, data segregation, and clear access control.\n\n1.  **Authorization Independence:** The design avoids hierarchical `get()` calls in security rules by denormalizing relevant authorization data directly into documents. For example, prescriptions store `patientId`, `doctorId`, and `pharmacyId` to facilitate independent authorization checks without needing to retrieve parent documents.\n\n2.  **Data Segregation:** Different data types with distinct access requirements are stored in separate collections. This simplifies security rules. For instance, patient profiles reside in `/patients/{patientId}`, while prescriptions are in `/prescriptions/{prescriptionId}`. Admin users are now stored in their own `/admins` collection, separate from `/doctors`.\n\n3.  **Access Control:** Path-based ownership is used for patient data (`/patients/{patientId}`). Prescriptions, while not directly owned by users, incorporate relevant IDs for secure access control.\n\n4.  **QAPs Support:**\n    *   `list` operations are secured by ensuring each collection has a homogeneous security posture (all documents in the same collection share the same access rules).\n\n5. **Invariants:**\n* The structure supports the integrity of ownership, timestamps, and denormalized data by making it straightforward to write rules that enforce restrictions.\n\nThis structure prioritizes simplicity and security, resulting in more robust and maintainable security rules."
  }
}
